<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width" />
		<link rel="icon" href="https://fav.farm/üìö" />
		<title>Portfolio - Vadim Soud√©</title>
		<script type="module">
			const theme = localStorage.getItem('color-scheme')
			theme
				? document.documentElement.setAttribute('color-scheme', theme)
				: localStorage.setItem('color-scheme', 'dark')
		</script>
		
		<link href="./_app/immutable/assets/0.eNqJEI-d.css" rel="stylesheet">
		<link href="./_app/immutable/assets/7.OBKwESGR.css" rel="stylesheet">
		<link rel="modulepreload" href="./_app/immutable/entry/start.tEqmjxNB.js">
		<link rel="modulepreload" href="./_app/immutable/chunks/index.BhcPLpiJ.js">
		<link rel="modulepreload" href="./_app/immutable/chunks/singletons.4egLlIh0.js">
		<link rel="modulepreload" href="./_app/immutable/chunks/paths.1ZQnB2E4.js">
		<link rel="modulepreload" href="./_app/immutable/chunks/control.g9yvpsvX.js">
		<link rel="modulepreload" href="./_app/immutable/entry/app.UEfe_cm1.js">
		<link rel="modulepreload" href="./_app/immutable/chunks/preload-helper.0HuHagjb.js">
		<link rel="modulepreload" href="./_app/immutable/nodes/0._Ld_sI_V.js">
		<link rel="modulepreload" href="./_app/immutable/chunks/config.IX8X3kk1.js">
		<link rel="modulepreload" href="./_app/immutable/nodes/7.B63wgKIY.js">
		<link rel="modulepreload" href="./_app/immutable/chunks/utils.YajTRkyr.js"><title>Deploiement Traefik avec Docker.</title><!-- HEAD_svelte-ylbs26_START --><meta property="og:type" content="article"><meta property="og:title" content="Deploiement Traefik avec Docker."><!-- HEAD_svelte-ylbs26_END -->
	</head>
	<body data-sveltekit-preload-data="hover">
		<div style="display: contents">



<div class="layout svelte-1sq3us8"><nav class="svelte-chi46"><a href="https://github.com/vadim-soude" class="a-header title svelte-chi46"><b class="svelte-chi46">Github</b>
		<svg class="svg" width="20" height="20" viewBox="0 0 16 16"><path d="M8 0c4.42 0 8 3.58 8 8a8.013 8.013 0 0 1-5.45 7.59c-.4.08-.55-.17-.55-.38 0-.27.01-1.13.01-2.2 0-.75-.25-1.23-.54-1.48 1.78-.2 3.65-.88 3.65-3.95 0-.88-.31-1.59-.82-2.15.08-.2.36-1.02-.08-2.12 0 0-.67-.22-2.2.82-.64-.18-1.32-.27-2-.27-.68 0-1.36.09-2 .27-1.53-1.03-2.2-.82-2.2-.82-.44 1.1-.16 1.92-.08 2.12-.51.56-.82 1.28-.82 2.15 0 3.06 1.86 3.75 3.64 3.95-.23.2-.44.55-.51 1.07-.46.21-1.61.55-2.33-.66-.15-.24-.6-.83-1.23-.82-.67.01-.27.38.01.53.34.19.73.9.82 1.13.16.45.68 1.31 2.69.94 0 .67.01 1.3.01 1.49 0 .21-.15.45-.55.38A7.995 7.995 0 0 1 0 8c0-4.42 3.58-8 8-8Z" fill="currentColor"></path></svg></a>

	<ul class="links svelte-chi46"><li><a class="a-header" href="/">Accueil</a></li>
		<li><a class="a-header" href="/projets">Projets</a></li>
		<li><a class="a-header" href="/article">Articles</a></li>
		<li><a class="a-header" href="/contact">Contacts</a></li></ul>

	<button aria-label="Toggle theme" class="svelte-114mtci"><div class="svelte-114mtci"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide-icon lucide lucide-moon "><path d="M12 3a6.364 6.364 0 0 0 9 9 9 9 0 1 1-9-9Z"></path></svg>
			<span>Dark</span></div>
</button>
</nav>

	<main class="svelte-1sq3us8"><div class="transition svelte-vcdv4c">

<article class="svelte-1p7w30y"><hgroup><h1 class="svelte-1p7w30y">Deploiement Traefik avec Docker.</h1>
		<p class="svelte-1p7w30y">Publi√© le 6 f√©vr. 2024</p></hgroup>

	<div class="tags svelte-1p7w30y"><span class="surface-4 svelte-1p7w30y">#Docker</span><span class="surface-4 svelte-1p7w30y">#R√©seau</span></div>

	<div class="prose"><h2 id="pr√©sentation-de-traefik">Pr√©sentation de Traefik</h2>
<p><a href="https://doc.traefik.io/traefik/" rel="nofollow">Traefik</a> est un service open source et gratuit permettant la mise en place d‚Äôun proxy
donnant la possibilit√©, entre autre, de deployer des services web sur des sous domaine.<br></p>
<p>Petit exemple pratique, vous avez un nom de domaine, vous souhaitez publier 2 applications web. <br></p>
<p>Vous ne pouvez pas utiliser des ports diff√©rents pour chacun, car vous souhaitez que les deux soient disponible en https (port 443).
Et vous ne souhaitez pas non plus, configurer un serveur Nginx unique pour rediriger sur le bon service selon une url pr√©cise. <br></p>
<p>Traefik peut donc √™tre une solution pour vous. Pour faire simple, vous pourrez avoir vos deux services sous forme de sous-domaine,
conserv√© le https, et ne pas avoir 1 serveur Nginx/Appache pour g√©rer le trafic.</p>
<p>Par exemple : <code>service1.exemple.fr</code> et <code>service2.exemple.fr</code></p>
<p>Super ! Voyons ensemble comment mettre cela en place.</p>
<h2 id="mise-en-place-de-traefik">Mise en place de Traefik</h2>
<blockquote><p><strong>DISCLAIMER :</strong>
L‚Äôensemble des manipulations suivantes ont √©t√© r√©alis√© sur <strong>Ubuntu Server 22.04 LTS</strong> avec <strong>Traefik v2.11</strong>.<br>
Si vous n‚Äôutilisez pas cette distribution Unix ou que vous utilisez un autre syst√®me d‚Äôexploitation certaines choses peuvent
√™tre diff√©rentes et je ne peux pas garantir que cela fonctionnera sur votre machine / serveur.</p></blockquote>
<p>Pour la mise en place de Traefik, nous allons utiliser <a href="https://www.docker.com" rel="nofollow">Docker</a>. Il est donc n√©cessaire de l‚Äôavoir install√©.</p>
<p>Pour d√©ployer le service rapidement et configurer le conteneur Docker de mani√®re clair, nous allons utiliser un docker compose.
La structure de directories sera comme suivant :</p>
<p>traefik :</p>
<ul><li>dockercompose.yml</li>
<li>letsencrypt :<ol><li>acme.json</li></ol></li></ul>
<blockquote><p>Le dir letsencrypt et son contenu seront g√©n√©r√© automatiquement.</p></blockquote>
<p>La documentation officielle peut √™tre retrouv√©e <a href="https://doc.traefik.io/traefik/providers/docker/" rel="nofollow">ici</a>.</p>
<p>Commen√ßons donc !</p>
<h2 id="le-fichier-docker-compose">Le fichier Docker Compose</h2>
<!-- HTML_TAG_START --><pre class="shiki poimandres" style="background-color: #1b1e28" tabindex="0"><code><span class="line"><span style="color: #5DE4C7">version</span><span style="color: #A6ACCD">: </span><span style="color: #A6ACCD">&#39;</span><span style="color: #5DE4C7">3</span><span style="color: #A6ACCD">&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #5DE4C7">services</span><span style="color: #A6ACCD">:</span></span>
<span class="line"><span style="color: #A6ACCD">  </span><span style="color: #767C9DB0; font-style: italic"># Nom du conteneur</span></span>
<span class="line"><span style="color: #A6ACCD">  </span><span style="color: #5DE4C7">traefik</span><span style="color: #A6ACCD">:</span></span>
<span class="line"><span style="color: #A6ACCD">    </span><span style="color: #767C9DB0; font-style: italic"># Active le red√©marrage automatique du conteneur</span></span>
<span class="line"><span style="color: #A6ACCD">    </span><span style="color: #5DE4C7">restart</span><span style="color: #A6ACCD">: </span><span style="color: #ADD7FF">always</span></span>
<span class="line"><span style="color: #A6ACCD">    </span><span style="color: #767C9DB0; font-style: italic"># Image docker officiel du Docker Hub</span></span>
<span class="line"><span style="color: #A6ACCD">    </span><span style="color: #5DE4C7">image</span><span style="color: #A6ACCD">: </span><span style="color: #ADD7FF">traefik:v2.11</span></span>
<span class="line"><span style="color: #A6ACCD">    </span><span style="color: #5DE4C7">command</span><span style="color: #A6ACCD">:</span></span>
<span class="line"><span style="color: #A6ACCD">      </span><span style="color: #767C9DB0; font-style: italic"># Active le Dashboard de Treafik</span></span>
<span class="line"><span style="color: #A6ACCD">      - </span><span style="color: #A6ACCD">&quot;</span><span style="color: #5DE4C7">--api.insecure=true</span><span style="color: #A6ACCD">&quot;</span></span>
<span class="line"><span style="color: #A6ACCD">      </span><span style="color: #767C9DB0; font-style: italic"># Active Docker comme provider</span></span>
<span class="line"><span style="color: #A6ACCD">      - </span><span style="color: #A6ACCD">&quot;</span><span style="color: #5DE4C7">--providers.docker=true</span><span style="color: #A6ACCD">&quot;</span></span>
<span class="line"><span style="color: #A6ACCD">      </span><span style="color: #767C9DB0; font-style: italic"># D√©sactive l&#39;exposition par d√©fault des services web du network Docker</span></span>
<span class="line"><span style="color: #A6ACCD">      - </span><span style="color: #A6ACCD">&quot;</span><span style="color: #5DE4C7">--providers.docker.exposedbydefault=false</span><span style="color: #A6ACCD">&quot;</span></span>
<span class="line"><span style="color: #A6ACCD">      </span><span style="color: #767C9DB0; font-style: italic"># D√©finit le port HTTP</span></span>
<span class="line"><span style="color: #A6ACCD">      - </span><span style="color: #A6ACCD">&quot;</span><span style="color: #5DE4C7">--entrypoints.web.address=:80</span><span style="color: #A6ACCD">&quot;</span></span>
<span class="line"><span style="color: #A6ACCD">      </span><span style="color: #767C9DB0; font-style: italic"># D√©finit le port HTTPS</span></span>
<span class="line"><span style="color: #A6ACCD">      - </span><span style="color: #A6ACCD">&quot;</span><span style="color: #5DE4C7">--entrypoints.websecure.address=:443</span><span style="color: #A6ACCD">&quot;</span></span>
<span class="line"><span style="color: #A6ACCD">      </span><span style="color: #767C9DB0; font-style: italic"># Active la gestion par Traefik des certificats HTTPS</span></span>
<span class="line"><span style="color: #A6ACCD">      - </span><span style="color: #A6ACCD">&quot;</span><span style="color: #5DE4C7">--certificatesresolvers.myresolver.acme.tlschallenge=true</span><span style="color: #A6ACCD">&quot;</span></span>
<span class="line"><span style="color: #A6ACCD">      </span><span style="color: #767C9DB0; font-style: italic"># Adresse mail du responsable des services web</span></span>
<span class="line"><span style="color: #A6ACCD">      - </span><span style="color: #A6ACCD">&quot;</span><span style="color: #5DE4C7">--certificatesresolvers.myresolver.acme.email=exemple@gmail.com</span><span style="color: #A6ACCD">&quot;</span><span style="color: #A6ACCD"> </span></span>
<span class="line"><span style="color: #A6ACCD">      </span><span style="color: #767C9DB0; font-style: italic"># Indique le fichier dans lequel les certificats doivent √™tre sauvegard√©</span></span>
<span class="line"><span style="color: #A6ACCD">      - </span><span style="color: #A6ACCD">&quot;</span><span style="color: #5DE4C7">--certificatesresolvers.myresolver.acme.storage=/letsencrypt/acme.json</span><span style="color: #A6ACCD">&quot;</span><span style="color: #A6ACCD"> </span></span>
<span class="line"><span style="color: #A6ACCD">    </span><span style="color: #5DE4C7">networks</span><span style="color: #A6ACCD">:</span></span>
<span class="line"><span style="color: #A6ACCD">      </span><span style="color: #767C9DB0; font-style: italic"># Le network auquel notre service doit etre attach√©</span></span>
<span class="line"><span style="color: #A6ACCD">      - </span><span style="color: #ADD7FF">traefik</span></span>
<span class="line"><span style="color: #A6ACCD">    </span><span style="color: #5DE4C7">ports</span><span style="color: #A6ACCD">:</span></span>
<span class="line"><span style="color: #A6ACCD">      - </span><span style="color: #A6ACCD">&quot;</span><span style="color: #5DE4C7">80:80</span><span style="color: #A6ACCD">&quot;</span><span style="color: #A6ACCD">     </span><span style="color: #767C9DB0; font-style: italic"># Port HTTP</span></span>
<span class="line"><span style="color: #A6ACCD">      - </span><span style="color: #A6ACCD">&quot;</span><span style="color: #5DE4C7">8080:8080</span><span style="color: #A6ACCD">&quot;</span><span style="color: #A6ACCD"> </span><span style="color: #767C9DB0; font-style: italic"># Port pour le Dashboard</span></span>
<span class="line"><span style="color: #A6ACCD">      - </span><span style="color: #A6ACCD">&quot;</span><span style="color: #5DE4C7">443:443</span><span style="color: #A6ACCD">&quot;</span><span style="color: #A6ACCD">   </span><span style="color: #767C9DB0; font-style: italic"># Port HTTPS</span></span>
<span class="line"><span style="color: #A6ACCD">    </span><span style="color: #5DE4C7">volumes</span><span style="color: #A6ACCD">:</span></span>
<span class="line"><span style="color: #A6ACCD">      </span><span style="color: #767C9DB0; font-style: italic"># Bind le socket docker</span></span>
<span class="line"><span style="color: #A6ACCD">      - </span><span style="color: #5DE4C7">type</span><span style="color: #A6ACCD">: </span><span style="color: #ADD7FF">bind</span></span>
<span class="line"><span style="color: #A6ACCD">        </span><span style="color: #5DE4C7">source</span><span style="color: #A6ACCD">: </span><span style="color: #ADD7FF">/var/run/docker.sock</span></span>
<span class="line"><span style="color: #A6ACCD">        </span><span style="color: #5DE4C7">target</span><span style="color: #A6ACCD">: </span><span style="color: #ADD7FF">/var/run/docker.sock</span></span>
<span class="line"><span style="color: #A6ACCD">      </span><span style="color: #767C9DB0; font-style: italic"># Bind le volume contenant les certificats</span></span>
<span class="line"><span style="color: #A6ACCD">      - </span><span style="color: #5DE4C7">type</span><span style="color: #A6ACCD">: </span><span style="color: #ADD7FF">bind</span></span>
<span class="line"><span style="color: #A6ACCD">        </span><span style="color: #5DE4C7">source</span><span style="color: #A6ACCD">: </span><span style="color: #ADD7FF">./letsencrypt</span></span>
<span class="line"><span style="color: #A6ACCD">        </span><span style="color: #5DE4C7">target</span><span style="color: #A6ACCD">: </span><span style="color: #ADD7FF">/letsencrypt</span></span>
<span class="line"><span style="color: #A6ACCD">    </span><span style="color: #5DE4C7">deploy</span><span style="color: #A6ACCD">:</span></span>
<span class="line"><span style="color: #A6ACCD">      </span><span style="color: #5DE4C7">resources</span><span style="color: #A6ACCD">:</span></span>
<span class="line"><span style="color: #A6ACCD">        </span><span style="color: #5DE4C7">limits</span><span style="color: #A6ACCD">:</span></span>
<span class="line"><span style="color: #A6ACCD">          </span><span style="color: #767C9DB0; font-style: italic"># Limite m√©moire, dans mon cas traefik utilise 40 Mo pour 3 services web</span></span>
<span class="line"><span style="color: #A6ACCD">          </span><span style="color: #5DE4C7">memory</span><span style="color: #A6ACCD">: </span><span style="color: #ADD7FF">350M</span><span style="color: #A6ACCD"> </span></span>
<span class="line"><span style="color: #A6ACCD">    </span><span style="color: #5DE4C7">labels</span><span style="color: #A6ACCD">:</span></span>
<span class="line"><span style="color: #A6ACCD">      </span><span style="color: #767C9DB0; font-style: italic"># Activation de Traefik</span></span>
<span class="line"><span style="color: #A6ACCD">      - </span><span style="color: #A6ACCD">&quot;</span><span style="color: #5DE4C7">traefik.enable=true</span><span style="color: #A6ACCD">&quot;</span></span>
<span class="line"><span style="color: #A6ACCD">      </span><span style="color: #767C9DB0; font-style: italic"># Adresse web du Dashboard</span></span>
<span class="line"><span style="color: #A6ACCD">      - </span><span style="color: #A6ACCD">&quot;</span><span style="color: #5DE4C7">traefik.http.routers.traefik.rule=Host(&#96;traefik.exemple.fr&#96;)</span><span style="color: #A6ACCD">&quot;</span></span>
<span class="line"><span style="color: #A6ACCD">      </span><span style="color: #767C9DB0; font-style: italic"># Activation de l&#39;HTTPS sur la page</span></span>
<span class="line"><span style="color: #A6ACCD">      - </span><span style="color: #A6ACCD">&quot;</span><span style="color: #5DE4C7">traefik.http.routers.traefik.entrypoints=websecure</span><span style="color: #A6ACCD">&quot;</span></span>
<span class="line"><span style="color: #A6ACCD">      </span><span style="color: #767C9DB0; font-style: italic"># Indication de la source du Dashboard</span></span>
<span class="line"><span style="color: #A6ACCD">      - </span><span style="color: #A6ACCD">&quot;</span><span style="color: #5DE4C7">traefik.http.routers.traefik.service=api@internal</span><span style="color: #A6ACCD">&quot;</span></span>
<span class="line"><span style="color: #A6ACCD">      </span><span style="color: #767C9DB0; font-style: italic"># Nom du certificat responsable du HTTPS</span></span>
<span class="line"><span style="color: #A6ACCD">      - </span><span style="color: #A6ACCD">&quot;</span><span style="color: #5DE4C7">traefik.http.routers.traefik.tls.certresolver=myresolver</span><span style="color: #A6ACCD">&quot;</span></span>
<span class="line"><span style="color: #A6ACCD">      </span><span style="color: #767C9DB0; font-style: italic"># Activation d&#39;un middleware pour prot√©ger le Dashboard par un mot de passe</span></span>
<span class="line"><span style="color: #A6ACCD">      - </span><span style="color: #A6ACCD">&quot;</span><span style="color: #5DE4C7">traefik.http.routers.traefik.middlewares=traefik-auth</span><span style="color: #A6ACCD">&quot;</span></span>
<span class="line"><span style="color: #A6ACCD">      </span><span style="color: #767C9DB0; font-style: italic"># D√©finition d&#39;un login et mot de passe</span></span>
<span class="line"><span style="color: #A6ACCD">      </span><span style="color: #767C9DB0; font-style: italic"># Utiliser la commande suivante va g√©n√©rer une chaine de caract√®re pour remplacer les XXXXX</span></span>
<span class="line"><span style="color: #A6ACCD">      </span><span style="color: #767C9DB0; font-style: italic">#    htpasswd -nb admin password </span></span>
<span class="line"><span style="color: #A6ACCD">      </span><span style="color: #767C9DB0; font-style: italic"># (Va gener√© le hash pour le login &quot;admin&quot; avec le mot de passe &quot;password&quot;)</span></span>
<span class="line"><span style="color: #A6ACCD">      - </span><span style="color: #A6ACCD">&quot;</span><span style="color: #5DE4C7">traefik.http.middlewares.traefik-auth.basicauth.users=XXXXX</span><span style="color: #A6ACCD">&quot;</span></span>
<span class="line"><span style="color: #A6ACCD">      </span><span style="color: #767C9DB0; font-style: italic"># Param√©trage du header du middleware (Replacer le domaine par le v√¥tre)</span></span>
<span class="line"><span style="color: #A6ACCD">      - </span><span style="color: #A6ACCD">&quot;</span><span style="color: #5DE4C7">traefik.http.middlewares.testheader.headers.accesscontrolallowmethods=GET,OPTIONS,PUT</span><span style="color: #A6ACCD">&quot;</span></span>
<span class="line"><span style="color: #A6ACCD">      - </span><span style="color: #A6ACCD">&quot;</span><span style="color: #5DE4C7">traefik.http.middlewares.testheader.headers.accesscontrolallowheaders=*</span><span style="color: #A6ACCD">&quot;</span></span>
<span class="line"><span style="color: #A6ACCD">      - </span><span style="color: #A6ACCD">&quot;</span><span style="color: #5DE4C7">traefik.http.middlewares.testheader.headers.accesscontrolalloworiginlist=https://exemple.fr</span><span style="color: #A6ACCD">&quot;</span></span>
<span class="line"><span style="color: #A6ACCD">      - </span><span style="color: #A6ACCD">&quot;</span><span style="color: #5DE4C7">traefik.http.middlewares.testheader.headers.accesscontrolmaxage=100</span><span style="color: #A6ACCD">&quot;</span></span>
<span class="line"><span style="color: #A6ACCD">      - </span><span style="color: #A6ACCD">&quot;</span><span style="color: #5DE4C7">traefik.http.middlewares.testheader.headers.addvaryheader=true</span><span style="color: #A6ACCD">&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #5DE4C7">networks</span><span style="color: #A6ACCD">:</span></span>
<span class="line"><span style="color: #A6ACCD">  </span><span style="color: #767C9DB0; font-style: italic"># Appel du network Docker</span></span>
<span class="line"><span style="color: #A6ACCD">  </span><span style="color: #5DE4C7">traefik</span><span style="color: #A6ACCD">:</span></span>
<span class="line"><span style="color: #A6ACCD">    </span><span style="color: #5DE4C7">external</span><span style="color: #A6ACCD">: </span><span style="color: #5DE4C7">true</span></span></code></pre><!-- HTML_TAG_END -->
<h2 id="comment-d√©ployer">Comment d√©ployer</h2>
<p>TODO : </p>
<ul><li>D√©finition du network docker</li>
<li>Docker compose up -d</li></ul>
<h2 id="comment-d√©finir-un-service-web-pour-un-sous-domaine">Comment d√©finir un service web pour un sous domaine</h2>
<p>TDOD :</p>
<ul><li>Labels √† ajouter au docker compose</li>
<li>Container √† ajouter au network docker</li></ul></div>
</article></div></main>

	<footer class="svelte-k2ae0s"><p class="svelte-k2ae0s">Portfolio - Vadim Soud√© ¬© 2024</p>
</footer>
</div>


			
			<script>
				{
					__sveltekit_oxv0mo = {
						base: new URL(".", location).pathname.slice(0, -1),
						env: {}
					};

					const element = document.currentScript.parentElement;

					const data = [null,null];

					Promise.all([
						import("./_app/immutable/entry/start.tEqmjxNB.js"),
						import("./_app/immutable/entry/app.UEfe_cm1.js")
					]).then(([kit, app]) => {
						kit.start(app, element, {
							node_ids: [0, 7],
							data,
							form: null,
							error: null
						});
					});
				}
			</script>
		</div>
	</body>
</html>
